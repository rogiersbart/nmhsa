<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started • nmhsa</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Getting started">
<meta property="og:description" content="nmhsa">
<meta property="og:image" content="https://rogiersbart.github.io/nmhsa/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nmhsa</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/nmhsa.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started</h1>
            
      
      
      <div class="hidden name"><code>nmhsa.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">nmhsa</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #FF5555;">!</span> {<span style="color: #0000BB;">nmhsa</span>} is still in its experimental lifecycle stage.</span></span>
<span><span class="co">#&gt; <span style="color: #FF5555;">!</span> Use at your own risk, and submit issues here:</span></span>
<span><span class="co">#&gt; <span style="color: #FF5555;">!</span> <span style="color: #0000BB; font-style: italic;">&lt;</span></span></span></code></pre></div>
<div class="section level2">
<h2 id="the-example-microstructure">The example microstructure<a class="anchor" aria-label="anchor" href="#the-example-microstructure"></a>
</h2>
<p>The {nmhsa} package comes with an example microstructure,
<em>i.e.</em> a segmented cement paste image, with labels 1:4
corresponding to pores and mineral phases portlandite, clinker and CSH
respectively:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cement</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">#</span> object of class <span style="color: #0000BB;">"nmhsa_array"</span> type <span style="color: #0000BB;">"integer"</span> [128x128]</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">.</span> <span style="color: #0000BB;">"'nmhsa_array'"</span> int [1:128, 1:128] 4 4 4 4 2 ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cement</span><span class="op">)</span></span></code></pre></div>
<p><img src="nmhsa_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>This is just a conventional R matrix / 2D array, with an S3 class
(“<code>nmhsa_array</code>”) for more useful printing and quick plotting
(well, for images with up to nine phases). Use the
<code>as.nmhsa_array()</code> function for adding the class to any other
matrix or array. Just try to make sure the values start with 1.</p>
</div>
<div class="section level2">
<h2 id="an-overview-of-the-algorithms">An overview of the algorithms<a class="anchor" aria-label="anchor" href="#an-overview-of-the-algorithms"></a>
</h2>
<p>We provide the three 2D examples of the original Python code here,
sometimes maybe relying on slightly different defaults. All these can be
easily extended to 3D reconstruction by providing the dimensions for the
reconstruction explicitly, instead of relying on the default behaviour,
which generates images of the same size as the training image.</p>
<div class="section level3">
<h3 id="hierarchical-simulated-annealing-hsa">Hierarchical simulated annealing (HSA)<a class="anchor" aria-label="anchor" href="#hierarchical-simulated-annealing-hsa"></a>
</h3>
<p>We only set <code>order</code> explicitly here, and rely on the
default parameters otherwise, as it does not exactly correspond to the
default <code>order</code>, which is from the least to the most
occurring phase:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reconstruction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsa.html">hsa</a></span><span class="op">(</span><span class="va">cement</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v</span> Preparing the Python backend ... done</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v</span> Reconstructing ... done</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cement</span>, <span class="va">reconstruction</span><span class="op">)</span></span></code></pre></div>
<p><img src="nmhsa_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="multiresolution-hierarchical-simulated-annealing-mhsa">Multiresolution hierarchical simulated annealing (MHSA)<a class="anchor" aria-label="anchor" href="#multiresolution-hierarchical-simulated-annealing-mhsa"></a>
</h3>
<p>To extend this to the multiresolution approach, we additionally
provide the <code>levels</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reconstruction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mhsa.html">mhsa</a></span><span class="op">(</span><span class="va">cement</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v</span> Reconstructing ... done</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cement</span>, <span class="va">reconstruction</span><span class="op">)</span></span></code></pre></div>
<p><img src="nmhsa_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="nested-multiresolution-hierarchical-simulated-annealing-nmhsa">Nested multiresolution hierarchical simulated annealing (NMHSA)<a class="anchor" aria-label="anchor" href="#nested-multiresolution-hierarchical-simulated-annealing-nmhsa"></a>
</h3>
<p>The NMHSA example is a bit more complex, as we need to preprocess the
training image to provide information on the phase merging and subphase
splitting. We first start by merging neighbouring pixels of phase 3 into
phase 2:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cement_merged</span> <span class="op">&lt;-</span> <span class="va">cement</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/phase_merge.html">phase_merge</a></span><span class="op">(</span><span class="fl">3</span>, into <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #FF5555;">!</span> Only merging touching pixels of phase 3 into 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cement</span>, <span class="va">cement_merged</span><span class="op">)</span></span></code></pre></div>
<p><img src="nmhsa_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Then we continue processing the image, and split off a series of
subphases:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cement_splitted</span> <span class="op">&lt;-</span> <span class="va">cement_merged</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/phase_split.html">phase_split</a></span><span class="op">(</span><span class="fl">1</span>, larger_than <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># large pores</span></span>
<span>  <span class="fu"><a href="../reference/phase_split.html">phase_split</a></span><span class="op">(</span><span class="fl">2</span>, larger_than <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># large portlandite components</span></span>
<span>  <span class="fu"><a href="../reference/phase_split.html">phase_split</a></span><span class="op">(</span><span class="fl">3</span>, larger_than <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># large clinker components</span></span>
<span>  <span class="fu"><a href="../reference/phase_split.html">phase_split</a></span><span class="op">(</span><span class="fl">7</span>, larger_than <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>   <span class="co"># extra large clinker components</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cement</span>, <span class="va">cement_splitted</span><span class="op">)</span></span></code></pre></div>
<p><img src="nmhsa_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Having these two modified versions of the training image, we can
start the reconstruction:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reconstruction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmhsa.html">nmhsa</a></span><span class="op">(</span></span>
<span>  ti <span class="op">=</span> <span class="va">cement</span>,</span>
<span>  ti_merged <span class="op">=</span> <span class="va">cement_merged</span>,</span>
<span>  ti_splitted <span class="op">=</span> <span class="va">cement_splitted</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  cool <span class="op">=</span> <span class="fl">0.98</span>,</span>
<span>  merge_pairs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v</span> Reconstructing ... done</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cement</span>, <span class="va">reconstruction</span><span class="op">)</span></span></code></pre></div>
<p><img src="nmhsa_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://rogiersbart.github.io" class="external-link">Bart Rogiers</a>, Laurent Lemmens.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
